# This is a basic workflow to help you get started with Actions

name: "Workflow de démonstration Branche DEv"

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches:
      - dev

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:

  # Création du porteclé SSH
  create_ssh:
    name: "Création du SSH"

    runs-on: ubuntu-latest

    steps:
      - name: "Create private SSH key"
      env:
        SSH_KEY: ${{ secrets.SSH_KEY }}
        SSH_HOST: ${{ secrest.SSH_HOST }}
        SSH_USER: ${{ secrest.SSH_USER }}
      run: |
        mkdir -p ~/.ssh/
        echo "$SSH_KEY" > ~/.ssh/id_rsa.key
        chmod 600 ~/.ssh/id_rsa.key
        cat >>~/.ssh/config <<END
          Host serveurProd
            HostName $SSH_HOST
            User $SSH_USER
            IdentityFile ~/.ssh/id_rsa.key
            StrictHostKeyChecking no
          END

      - name: "Connexion au serveur de prod"
      run: |
        ssh serveurProd



  # Nom du job
  hello:
    name: Hello World

    # Environnement virtuel du job
    # https://docs.github.com/articles/virtual-environments-for-github-actions
    runs-on: ubuntu-latest

    steps:
      - run: echo "HelloWorld"

      # On crée le fichier toto
      - name: Create toto.txt file
        env:
          SSH_KEY: ${{ secrets.TOTO }}
        run: |
          echo "$SSH_KEY" > toto.txt && echo "after secret" >> toto.txt && cat toto.txt
